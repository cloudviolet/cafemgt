<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cafemgt.dao.UserMapper">

	<resultMap type="UserDto" id="userResulMap">
		
		<result property="memberId" 		column="member_id"/>
		<result property="storeInfoCode" 	column="store_info_code"/>
		<result property="storeInfoName" 	column="store_info_name"/>
		<result property="levelCode" 		column="level_code"/>
		<result property="levelName" 		column="level_name"/>
		<result property="userJoinDate" 	column="user_join_date"/>
		<result property="userOutDate" 		column="user_out_date"/>
		<result property="userPay" 			column="user_pay"/>
		<result property="userWorkTime" 	column="user_work_time"/>
		<result property="userBankName" 	column="user_bank_name"/>
		<result property="userBankAcount" 	column="user_bank_acount"/>
		<result property="userAgreement" 	column="user_agreement"/>
		<result property="userHealthCard" 	column="user_health_card"/>
		<association property="memberDto" javaType="MemberDto">
			<id property="memberId" column="member_id"/>
				<result property="memberPw" 		column="member_pw" />
				<result property="memberName" 		column="member_name" />
				<result property="levelCode" 		column="level_code" />
				<result property="levelName" 		column="level_name" />
				<result property="storeInfoCode"	column="store_info_code" />
				<result property="storeInfoName"	column="store_info_name" />
				<result property="memberPhone" 		column="member_phone" />
				<result property="memberEmail" 		column="member_email" />
				<result property="memberBirth" 		column="member_birth" />
				<result property="memberRegDate" 	column="member_reg_date" />
		</association>
	</resultMap>
	
	<!-- User 직원 등록 -->
	<insert id="addUser" parameterType="UserDto">
		INSERT INTO tb_user
	(user_id
		, user_pw
		, store_info_code
		, user_name
		, level_code
		, user_join_date
		, user_phone
		, user_pay
		, user_work_time
		, user_bank_name
		, user_bank_acount
		, user_agreement
		, user_health_card
		, user_reg_date)
	VALUES (#{userId}
		, #{userPw}
		, #{storeInfoCode}
		, #{userName}
		, #{levelCode}
		, NOW()
		, #{userPhone}
		, ${userPay}
		, ${userWorkTime}
		, #{userBankName}
		, #{userBankAcount}
		, #{userAgreement}
		, #{userHealthCard}
		, NOW())
	</insert>
	<!-- User 직원 조회 관리 -->
	<select id="getUseradmin" parameterType="String" resultMap="userResulMap">
		SELECT 
			u.member_id
			, m.member_name
			, s.store_info_code
			, s.store_info_name
			, m.member_phone
			, m.member_reg_date
			, l.level_code
			, l.level_name
			, u.user_join_date
			, u.user_out_date
			, u.user_pay
			, u.user_work_time
			, u.user_bank_name
			, u.user_bank_acount
			, u.user_agreement
			, u.user_health_card
		FROM tb_user AS u
			LEFT join
				tb_member AS m
			ON m.member_id = u.member_id
			LEFT join
				tb_store_info AS s
			ON s.store_info_code = u.store_info_code
			LEFT join
				tb_level AS l
			ON l.level_code =u.level_code
	</select>
	<!-- User 직원 조회  -->
	<select id="getUser" parameterType="String" resultMap="userResulMap">
		SELECT 
			u.member_id
			, m.member_name
			, s.store_info_code
			, s.store_info_name
			, m.member_phone
			, m.member_reg_date
			, l.level_code
			, l.level_name
			, u.user_join_date
			, u.user_out_date
			, u.user_pay
			, u.user_work_time
			, u.user_bank_name
			, u.user_bank_acount
			, u.user_agreement
			, u.user_health_card
		FROM tb_user AS u
			LEFT join
				tb_member AS m
			ON m.member_id = u.member_id
			LEFT join
				tb_store_info AS s
			ON s.store_info_code = u.store_info_code
			LEFT join
				tb_level AS l
			ON l.level_code =u.level_code
			WHERE s.store_info_code = #{SSTORECODE}
	</select>
</mapper>