<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="@{layout/default}">

	<th:block layout:fragment="customTitle">
		<title>부가세조회</title>
	</th:block>

	<th:block layout:fragment="customContents">
			<div class="right_col" role="main">
			<div class="col-md-12 col-sm-12 ">
				<div class="x_panel">
					 <div class="x_title">
	                    <h2>예상 부가세 조회</h2>
	                    <ul class="nav navbar-right panel_toolbox">
	                    	<li>
	                    		<button type="button" class="btn btn-link" data-toggle="modal" data-target="#myModal">
									중간예납 등록
								</button>	                    		
	                    	</li>
						</ul>
						<!-- 중간예납 등록 모달 -->
						<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
						  <div class="modal-dialog">
						    <div class="modal-content">
						      <div class="modal-header">
						        <h4 class="modal-title" id="myModalLabel">중간예납 등록</h4>
						        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						      </div>
						      <div class="row modal-body">
								<form class="form-inline">
									<div class="form-group">
										<select name="year" id="intendedYear" title="년도" class="custom-select"></select>
									</div>
									<div class="form-group">
										<select id="intendedMonth" class="custom-select">					      	
											<option value="">해당분기</option>
											<option value="1기">1기</option>
											<option value="2기">2기</option>
										</select>
									</div>
									<div class="form-group">
										<input type="text" class="form-control" id="vatIntendedTax" placeholder="중간예납금액">
										<label for="vatIntendedTax"> 원</label>
									</div>
								</form>							   
						      </div>
						      <div class="modal-footer">
						        <button type="button" class="btn btn-default" data-dismiss="modal">취소</button>
						        <button type="button" id="addIntendedTax" class="btn btn-primary">등록</button>
						      </div>
						    </div>
						  </div>
						</div>
						<div class="clearfix"></div>
					</div>
					<div class="x_content">
						<div class="row">
							<div class="col-sm-12">
								<div class="card-box table-responsive">
									<p class="text-muted font-13 m-b-30">
										여기에 설명써주시면됩니다.
										<code>강조!</code>
									</p>
							<div class="col-label col-md-4 col-sm-4">				
						      	<select name="year" id="year" title="년도" class="custom-select"></select>
						    </div>
						    <div class="col-label col-md-4 col-sm-4">
						      	<select id="month" class="custom-select">					      	
						      		<option value="">분기</option>
						      		<option value="1기">1기</option>
						      		<option value="2기">2기</option>
						      	</select>
						   </div>
						     <div class="col-label col-md-2 col-sm-2">
						      	<button  type="button" id="forVatBtn" class="btn btn-info">검색</button>
						     </div>					      
					      <div class="col-label col-md-6 col-sm-6 label-align" style="font-size: large; line-height: 50px;">
						      <div id="vatTitle"></div>
						      <div id="getSalesTotal"></div>
						      <div id="getSalesSupply"></div>
						      <div id="getSalesTax"></div>
						      <div id="getPurchasesTotal"></div>
						      <div id="getPurchasesSupply"></div>
						      <div id="getPurchasesTax"></div>
						      <div id="getIntendedTax"></div>
						      <div id="i"></div>
					      </div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>	
		</div>
	</th:block>
	
	<th:block layout:fragment="customJs">
		<script type="text/javascript">
		    $(document).ready(function(){
		    	//가입년도 가져오기.
			    var getYear = Number('[[${getYear}]]');		    	
			    console.log(getYear);
			    //해당년도 가져오기
		    	var dt = new Date();
		        var Nowyear = dt.getFullYear();
		        //해당년도 - 가입년도
		        var yearInt = Nowyear-getYear;
		        console.log(yearInt);
		        //뿌려주기
		    	$('#year').append("<option value=''>해당 년도를 선택해주세요.</option>");
		    	$('#intendedYear').append("<option value=''>해당 년도</option>");
		    	//올해기준으로 가입년도까지 보여주기
		    	for(var y = (Nowyear); y >= (Nowyear-yearInt); y--){
		    		$('#year').append("<option value='"+y+"'>"+y+"년"+"</option>");
		    		$('#intendedYear').append("<option value='"+y+"'>"+y+"년"+"</option>");
		    	}
		    });	
		    
		    var MNAME = ('[[${MNAME}]]');
		    //부가세 조회버튼 
		    $('#forVatBtn').click(function(){
				var yearValue = $('#year').val();
				var monthValue = $('#month').val();
				var searchDays = yearValue+"년"+monthValue;
				console.log(searchDays);
				var request = $.ajax({
					url: "getmyvat", 
					method: "POST",
					data: { searchDays : searchDays},
					dataType: "json"
				,
		        success : function(vatResult) {
		        	console.log(vatResult,"<><<<<<<<<<<<<<<<<<<<<<<<<<<<<");
		        	var vatCode = vatResult.vatCode;
		        	var StoreInfoCode = vatResult.StoreInfoCode;
		        	var VatDate = vatResult.vatDate;
		        	var VatSaleSupplyValue = vatResult.vatSaleSupplyValue;
		        	var VatSalesTax = vatResult.vatSalesTax;
		        	var VatSalesTotal = VatSaleSupplyValue+VatSalesTax;
		        	var VatPurchaseSupplyValue = vatResult.vatPurchaseSupplyValue;
		        	var VatPurchaseTax = vatResult.vatPurchaseTax;
		        	var VatPurchasesTotal = VatPurchaseSupplyValue+VatPurchaseTax;
		        	var VatIntendedTax = vatResult.vatIntendedTax;
		        	var VatDeemedInputTax = vatResult.vatDeemedInputTax;
		        	var VatExclusionTax = vatResult.vatExclusionTax;
		        	var VatCardTax = vatResult.vatCardTax;
		        	var VatAdditionalTax = vatResult.vatAdditionalTax;
		        	var VatPaymentTax = vatResult.vatPaymentTax;
		        	$('#vatTitle').text(MNAME+'님의 '+searchDays+' 예상 부가가치세 내역입니다.');
		        	$('#getSalesTotal').text('매출총공급합계:  '+VatSalesTotal+'원');
		        	$('#getSalesSupply').text('매출총공급가액:  '+VatSaleSupplyValue+'원');
		        	$('#getSalesTax').text('매출총공급세액:  '+VatSalesTax+'원');
		        	$('#getPurchasesTotal').text('매입총공급합계:  '+VatPurchasesTotal+'원');
		        	$('#getPurchasesSupply').text('매입총공급가액:  '+VatSalesTax+'원');
		        	$('#getPurchasesTax').text('매입총공급세액:  '+VatPurchaseSupplyValue+'원');
		        	$('#getIntendedTax').text('중간예납금액:  '+VatIntendedTax+'원');
		        },
		        error : function(xhr,status,error) {
		        	console.log("xhr: " + xhr);
		        	console.log("status: " + status);
		        	console.log("error: " + error);
		        	 $('#chartTable').hide();
		        }
				});
		    });
		    
		    //중간예납등록버튼
		    $('#addIntendedTax').click(function(){
		    	var intendedYearValue = $('#intendedYear').val();
				var intendedMonthValue = $('#intendedMonth').val();
				var intendedDays = intendedYearValue+"년"+intendedMonthValue;
				var vatIntendedTax = $('#vatIntendedTax').val();
				console.log(intendedDays);
				if(intendedYearValue==''){
					alert('해당년도를 선택해주세요.');
				}else if(intendedMonthValue==''){
					alert('해당 분기를 선택해주세요.');
				}else if(vatIntendedTax==''){
					alert('중간예납금액을 입력해주세요.');
				}else{					
					var request = $.ajax({
						url: "addintendedtax", 
						method: "POST",
						data: { intendedDays : intendedDays,
								vatIntendedTax : vatIntendedTax},
						dataType: "json"
					,
			        success : function(intendedResult) {
			        	if(intendedResult){
			        		alert(intendedDays+' 중간예납금액 '+vatIntendedTax+'원이 등록되었습니다.');
			        		$('#myModal').modal('hide');
			        		$('#myModal').find('form')[0].reset();
			        	}else{
			        		alert('중간에납금액등록에 실패하였습니다.');
			        	}
			        },
			        error : function(xhr,status,error) {
			        	console.log("xhr: " + xhr);
			        	console.log("status: " + status);
			        	console.log("error: " + error);
			        	 $('#chartTable').hide();
			        }
					});
				}
			    });
		   
		</script>
	</th:block>
</html>